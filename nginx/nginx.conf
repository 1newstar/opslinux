#使用小号
user  nginx;

#开启进程数
worker_processes  4;

#dso {
#     load ngx_pagespeed.so;
#}
#制定进程到cpu（四cpu：0001 0010 0100 1000）
#worker_cpu_affinity 0001 0010 0100 1000 0001 0010 0100 1000;

#每个进程最大打开文件数
worker_rlimit_nofile 51200;

#进程号保存文件
pid    /var/run/nginx.pid;

events {
    #使用epoll（linux2.6的高性能方式）
    use epoll;
    #每个进程最大连接数（最大连接=连接数x进程数）
    worker_connections  51200;
}

http {

#文件扩展名与文件类型映射表
include       mime.types;

#默认文件类型
default_type  text/html;

#curl 上传文件的路径
client_body_temp_path /data0/upload 1 2;

#设置上传文件的最大限制
client_max_body_size 1024m;

#日志文件格式
#log_format  main  '$remote_addr - $remote_user [$time_local] $request '
#                  '"$status" $body_bytes_sent "$http_referer" '
#                  '"$http_user_agent" "$http_x_forwarded_for"';

## Log Format
log_format main         '$remote_addr - $remote_user [$time_local] '
                        '"$request" $status $body_bytes_sent '
                        '"$http_referer" "$http_user_agent" '
                        '"$http_Cdn_Src_Ip" "$upstream_addr" "$upstream_status" "$request_time" "$upstream_response_time"';

        log_format cdn         '$http_x_forwarded_for - $remote_user [$time_local] '
                                '"$request" $status $bytes_sent '
                                '"$http_referer" "$http_user_agent" '
                                '"$remote_addr" "$gzip_ratio" "$upstream_addr" "$upstream_status" "$request_time" "$upstream_response_time"';

        log_format zwccdn       '$http_x_forwarded_for - $remote_user [$time_local] '
                    '"$request" $status $bytes_sent '
                    '"$http_referer" "$http_user_agent" "$host" '
                    '"$remote_addr" "$gzip_ratio" "$upstream_addr" "$upstream_status" "$request_time" "$upstream_response_time"  "$upstream_cache_status"';

        log_format  zwc   '$remote_addr - $remote_user [$time_local] "$request" '
                          '$status $body_bytes_sent "$http_referer" '
                          '"$http_user_agent" "$upstream_addr" "$upstream_status" "$request_time" "$upstream_response_time"';

        log_format zwclogtest         '$http_x_forwarded_for - $remote_user [$time_local] '
                                '"$request" $status $bytes_sent '
                                '"$http_referer" "$http_user_agent" '
                                '"$remote_addr" "$gzip_ratio" "$upstream_addr" "$upstream_status" "$request_time" "$upstream_response_time" "$host"'
                                ' "VUID=$cookie_VUID; NAGENTID=$cookie_NAGENTID; JSESSIONID=$cookie_JSESSIONID; CPLOGIN=$cookie_CPLOGIN; AUM=$cookie_AUM;'
                                ' SEO_SEARCH_WEBSITE=$cookie_SEO_SEARCH_WEBSITE; SEO_SEARCH_KEYWORD=$cookie_SEO_SEARCH_KEYWORD;'
                                ' SEO_SEARCH_TARGET_URL=$cookie_SEO_SEARCH_TARGET_URL"';

    log_format zwcfluentd       '"$host" $http_x_forwarded_for - $remote_user [$time_local] '
                    '"$request" $status $bytes_sent '
                    '"$http_referer" "$http_user_agent" '
                    '"$remote_addr" "$gzip_ratio" "$upstream_addr" "$upstream_status" "$request_time" "$upstream_response_time"';

#日志文件
access_log  /dev/null;
error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#长链接超时时间
keepalive_timeout  30;

#打开gzip压缩
gzip  on;
#最小压缩文件大小
gzip_min_length  1000;
#压缩缓冲区
gzip_buffers     4 8k;
#压缩类型
gzip_types       text/* text/css application/javascript application/x-javascript;
#压缩比率
gzip_comp_level  9;
#压缩通过代理的所有文件
gzip_proxied     any;
#vary header支持
gzip_vary        on;
#压缩版本（默认1.1，前端为squid2.5使用1.0）
gzip_http_version 1.0;
#输出缓冲区
output_buffers   4 32k;
#输出拆包大小
postpone_output  1460;

#接收header的缓冲区大小
client_header_buffer_size 128k;
large_client_header_buffers 4 256k;

server_names_hash_bucket_size 512;

#客户端发送header超时
client_header_timeout  10m;
#客户端发送内容超时
client_body_timeout    10m;
#发送到客户端超时
send_timeout           10m;
#开启高效文件传输模式
sendfile                on;
#捕捉代理端的http错误
#proxy_intercept_errors  on;
#默认编码
charset utf-8;

#support shtml
ssi on;
ssi_silent_errors on;
ssi_types text/shtml;

#proxy_cache_path   /tmp/ng_proxy_cache_dir levels=1:2  keys_zone=proxy_cache:200m inactive=7d max_size=5G;
#proxy_temp_path   /tmp/ng_proxy_temp_dir;

#fastcgi_temp_path   /tmp/ng_fastcgi_temp_dir;
#fastcgi_cache_path /tmp/ng_fastcgi_cache_dir levels=1:2 keys_zone=fastcgi_cache:200m inactive=7d max_size=5G;

##应用防火墙
#lua_code_cache off;
#init_by_lua_file  /usr/local/nginx/conf/init.lua;
#access_by_lua_file /usr/local/nginx/conf/waf.lua;
#lua_shared_dict updatedict 10m;

#upstream配置文件
    include /usr/local/nginx/conf/upstream.conf;

    include /usr/local/nginx/conf/vhost/*.conf;

}
